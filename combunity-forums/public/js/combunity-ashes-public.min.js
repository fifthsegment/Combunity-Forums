!function(a){a.fn.extend({leanModal:function(b){function c(b){a("#lean_overlay").fadeOut(200),a(b).css({display:"none"})}var d={top:100,overlay:.5,closeButton:null,cb:null},e=a("<div id='lean_overlay'></div>");return a("body").append(e),b=a.extend(d,b),this.each(function(){var d=b;a(this).click(function(e){var f=a(this).attr("href");a("#lean_overlay").click(function(){c(f)}),a(d.closeButton).click(function(){c(f)});var g=(a(f).outerHeight(),a(f).outerWidth()),g=60*a(window).width()/100;a("#lean_overlay").css({display:"block",opacity:0}),a("#lean_overlay").fadeTo(200,d.overlay),a(f).css({display:"block",position:"fixed",opacity:0,"z-index":11e3,left:"20%",top:d.top+"px",width:g+"px"}),a(f).fadeTo(200,1),b.cb&&b.cb(e),e.preventDefault()})})}})}(jQuery),function(a){"use strict";var b=function(a,b,c,d){jQuery.post(a,b,function(a){if(0==a)return void jQuery(d).find(".validation").text("Submission Failed").css("color","red");var b=jQuery.parseJSON(a);c(b)})};combunity.performAPIcall=b,combunity.editor={},combunity.editor.temp={};var c="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0nMTIwcHgnIGhlaWdodD0nMTIwcHgnIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDEwMCAxMDAiIHByZXNlcnZlQXNwZWN0UmF0aW89InhNaWRZTWlkIiBjbGFzcz0idWlsLWJhbGxzIj48cmVjdCB4PSIwIiB5PSIwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0ibm9uZSIgY2xhc3M9ImJrIj48L3JlY3Q+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMCA1MCA1MCkiPgogIDxjaXJjbGUgcj0iNSIgY3g9IjMwIiBjeT0iNTAiPgogICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJ0cmFuc2xhdGUiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGR1cj0iMXMiIHZhbHVlcz0iMCAwOzE5Ljk5OTk5OTk5OTk5OTk5NiAtMjAiIGtleVRpbWVzPSIwOzEiLz4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImZpbGwiIGR1cj0iMXMiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICBrZXlUaW1lcz0iMDsxIiB2YWx1ZXM9IiNmZmY7Izk5OSIvPgogIDwvY2lyY2xlPgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoOTAgNTAgNTApIj4KICA8Y2lyY2xlIHI9IjUiIGN4PSIzMCIgY3k9IjUwIj4KICAgIDxhbmltYXRlVHJhbnNmb3JtIGF0dHJpYnV0ZU5hbWU9InRyYW5zZm9ybSIgdHlwZT0idHJhbnNsYXRlIiBiZWdpbj0iMHMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiBkdXI9IjFzIiB2YWx1ZXM9IjAgMDsxOS45OTk5OTk5OTk5OTk5OTYgLTIwIiBrZXlUaW1lcz0iMDsxIi8+CiAgICA8YW5pbWF0ZSBhdHRyaWJ1dGVOYW1lPSJmaWxsIiBkdXI9IjFzIiBiZWdpbj0iMHMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIiAga2V5VGltZXM9IjA7MSIgdmFsdWVzPSIjOTk5OyMwMDAiLz4KICA8L2NpcmNsZT4KPC9nPjxnIHRyYW5zZm9ybT0icm90YXRlKDE4MCA1MCA1MCkiPgogIDxjaXJjbGUgcj0iNSIgY3g9IjMwIiBjeT0iNTAiPgogICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJ0cmFuc2xhdGUiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiIGR1cj0iMXMiIHZhbHVlcz0iMCAwOzE5Ljk5OTk5OTk5OTk5OTk5NiAtMjAiIGtleVRpbWVzPSIwOzEiLz4KICAgIDxhbmltYXRlIGF0dHJpYnV0ZU5hbWU9ImZpbGwiIGR1cj0iMXMiIGJlZ2luPSIwcyIgcmVwZWF0Q291bnQ9ImluZGVmaW5pdGUiICBrZXlUaW1lcz0iMDsxIiB2YWx1ZXM9IiMwMDA7I2ZmZiIvPgogIDwvY2lyY2xlPgo8L2c+PGcgdHJhbnNmb3JtPSJyb3RhdGUoMjcwIDUwIDUwKSI+CiAgPGNpcmNsZSByPSI1IiBjeD0iMzAiIGN5PSI1MCI+CiAgICA8YW5pbWF0ZVRyYW5zZm9ybSBhdHRyaWJ1dGVOYW1lPSJ0cmFuc2Zvcm0iIHR5cGU9InRyYW5zbGF0ZSIgYmVnaW49IjBzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgZHVyPSIxcyIgdmFsdWVzPSIwIDA7MTkuOTk5OTk5OTk5OTk5OTk2IC0yMCIga2V5VGltZXM9IjA7MSIvPgogICAgPGFuaW1hdGUgYXR0cmlidXRlTmFtZT0iZmlsbCIgZHVyPSIxcyIgYmVnaW49IjBzIiByZXBlYXRDb3VudD0iaW5kZWZpbml0ZSIgIGtleVRpbWVzPSIwOzEiIHZhbHVlcz0iI2ZmZjsjOTk5Ii8+CiAgPC9jaXJjbGU+CjwvZz48L3N2Zz4=";combunity.loadersrc=c;var d='<svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52"><circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none"/><path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8"/></svg>',e={selector:".combunity-rte",menubar:!1,statusbar:!0,toolbar:"undo redo | bold italic strikethrough underline | emoticons  link image | blockquote | ",plugins:["advlist autolink link image advlist textcolor emoticons wordcount"],advlist_bullet_styles:"square",init_instance_callback:function(a){a.on("keypress",function(b){"@"==b.key&&(a.windowManager.open({title:"Search user",url:"/?combunity_custom&editor=frontend&type=userpicker",width:50,height:100},{arg1:42,arg2:"Hello world"}),b.preventDefault())})},setup:function(a){a.on("init",function(a){console.debug(a.target.id);var b=tinymce.get(a.target.id).getParam("initiator");b&&(g(b.params.container),b.tempcontainer.show())})}},f=function(b){var d=a(b).contents();combunity.temporary=d;var e=jQuery("<div style='text-align:center'><img class='combunity-loader'  src='"+c+"'></img></div>");a(b).text(""),a(b).append(e)};combunity.showloading=f;var g=function(b){a(b).find(".combunity-loader").remove()};combunity.hideloading=g;var h=function(c){var h=this;this.params=c,this.btnsave=null,this.btncancel=null,this.validation=null,this.containercontents=null,this.formstruct=null,this.security=null,this.fetch=function(){h.containercontents=h.params.container.contents(),f(h.params.container);var a={};h.params.id&&(a.id=h.params.id),h.params.passdata&&(console.log("I have pass data"),a.additional={cforum:h.params.passdata.cforum});var c={action:h.params.action,data:a},d=combunity.ajax_url;b(d,c,function(a){a.error?(h.validation=jQuery("<div></div>"),h.validation.attr("class","combunity-validation-error"),h.validation.text(a.info),g(h.params.container),h.params.container.append(h.validation)):h.params.isdelete?(console.log("Is delete section running "),g(h.params.container),h.validation=jQuery("<div></div>"),h.validation.html(a.info),g(h.params.container),h.params.container.append(h.validation)):(h.formstruct=a.info,h.security=a.security,h.build())})},this.build=function(){for(var b=jQuery("<div></div>"),c=0;c<h.formstruct.length;c++){var d=h.formstruct[c],f=null;switch(d.etype){case"select":var f=jQuery("<select></select>");f.attr("name",d.name),f.attr("value",d.value);for(var g=d.options.length-1;g>=0;g--){var i=d.options[g],j=jQuery("<option></option>");i.selected&&j.attr("selected",!0),j.text(i.name),j.attr("value",i.slug),f.append(j)}h.formstruct[c].element=f;break;case"text":var f=jQuery("<input>");f.attr("type","text"),f.attr("name",d.name),f.attr("value",d.value),h.formstruct[c].element=f;break;case"textarea":var f=jQuery("<textarea></textarea>");f.attr("name",d.name),f.text(d.value),h.formstruct[c].element=f,d.rte&&f.addClass("combunity-rte");break;case"hidden":var f=jQuery("<input>");f.attr("type","hidden"),f.attr("name",d.name),f.attr("value",d.value),h.formstruct[c].element=f;break;case"notice":var f=jQuery("<p></p>");f.attr("name",d.name),d.class&&f.attr("class",d.class),f.html(d.value),h.formstruct[c].element=f}if(h.params.labels&&"hidden"!=d.etype){var k=jQuery("<label></label>");d.label?k.text(d.label):k.text(d.name),b.append(k)}b.append(f)}h.validation=jQuery("<div></div>"),h.validation.attr("class","combunity-form-validation");var l="Save";h.params.savebtntext&&(l=h.params.savebtntext),h.btnsave=jQuery("<button>"+l+"</button>"),h.btnsave.attr("class","btn btn-primary combunity-ajax-save"),h.btncancel=jQuery("<button>Cancel</button>");var m="";h.params.nocancel&&(m=" hidden "),h.btncancel.attr("class","btn btn-info combunity-ajax-cancel"+m),h.btnsave.on("click",h.save),h.btncancel.on("click",h.cancel);var n=a("<div></div>");n.attr("class","combunity-ajax-btn-container"),n.append(h.btncancel),n.append(h.btnsave),b.append(n),b.append(h.validation),e.selector=".combunity-rte",console.log("Assigning intiator;"),e.initiator=h,h.tempcontainer=b,b.hide(),h.params.container.append(b),tinymce.init(e)},this.init=function(){this.fetch()},this.cancel=function(){h.params.container.html(h.containercontents)},this.save=function(){h.containercontents=h.params.container.contents(),f(h.params.container);for(var c={},e=h.formstruct.length-1;e>=0;e--)h.formstruct[e].rte?c[h.formstruct[e].name]=tinyMCE.activeEditor.getContent():c[h.formstruct[e].name]=h.formstruct[e].element.val();var i={action:h.params.action_save,data:c,security:h.security};b(combunity.ajax_url,i,function(b){if(g(h.params.container),h.params.container.text(""),h.params.container.append(h.validation),b.error)h.validation.html(b.info);else{for(var c=h.formstruct.length-1;c>=0;c--)h.formstruct[c].element.remove();h.validation.html("");var e=a('<div style="text-align:center" >'+d+"</div>");h.validation.append(e);var f=b.info.validation;h.params.align||(h.params.align="left"),h.validation.append('<div style="text-align:'+h.params.align+'" >'+f+"</div>"),h.params.animatedtick||setInterval(function(){e.remove()},1200)}})},this.init()};a(function(){if(a("#comment").length>0&&"undefined"!=typeof tinymce){a("#commentform").attr("novalidate",""),e.selector="#comment";tinymce.init(e);a("#submit").on("click",function(b){a("#comment").val(tinyMCE.activeEditor.getContent())})}var c=function(){var a=null,b=[];return window.screen&&(b.pixelDepth=window.screen.pixelDepth,b.availWidth=window.screen.availWidth,b.availHeight=window.screen.availHeight,b.actWidth=window.screen.height,b.actHeight=window.screen.width,b.dppx=window.devicePixelRatio),b.actWidth<b.actHeight&&(a=b.actWidth),b.actHeight<b.actWidth&&(a=b.actHeight),a<=414};if(combunity.detectMobile=c,a("#submitpost").on("click",function(b){"undefined"==typeof tinymce&&a("#submitpost").attr("href","#loginmodal")}),a("#submitpost").on("click",function(a){}),combunity.detectMobile()||a("#submitpost").leanModal({top:100,closeButton:".modal_close",cb:function(){if(console.log("Clicked on submit post"),"undefined"!=typeof tinymce){var b=jQuery("#submitpostform .submissionform");new h({action:"combunity_get_forum_posts_form_meta",passdata:{cforum:a("#submitpost").data("forum")},action_save:"combunity_forum_posts_post",container:b,labels:!0,animatedtick:!0,align:"center",nocancel:!0,savebtntext:"Post"})}}}),a(".newpost").on("click",function(){a("#submitpost").trigger("click")}),a(".comment-reply-link").on("click",function(a){e.selector="#comment",tinymce.remove(),setInterval(function(){tinymce.init(e)},100)}),a(".combunity-voting-bar-vote-comment").on("click",function(){var c=this,d=jQuery(this).parent().parent().data("postid"),e=jQuery(this).data("posttype"),f=(jQuery(this).parent(),this),g={id:d,vote_type:e},h={action:"combunity_post_comment_vote",data:g};a(this).css("position","relative"),a(this).css("z-index",1e3),a(this).animate({fontSize:"30px",left:"-14px",top:"-20px"},1e3);var i=a(this).css("font-size"),j=a(this).css("top");console.log(i),b(combunity.ajax_url,h,function(b){if(!b.error){var d="combunity-vote-"+e+"-highlight";a(f).addClass(d)}a(c).animate({fontSize:i,left:"0px",top:j},1e3)})}),a(".edit-comment").on("click",function(a){var b=this;console.log("Edit comment"),a.preventDefault();var c={};c.id=jQuery(this).data("id");var d=jQuery(b).closest(".combunity-comment-box").find(".comment-text");new h({action:"combunity_get_comment_form_meta",action_save:"combunity_post_comment",id:c.id,container:d,labels:!1})}),a(".combunity-edit-thread-link").on("click",function(a){var b=this;console.log("Edit thread"),a.preventDefault();var c={};c.id=jQuery(this).data("id");var d=jQuery(b).closest(".post-body").find(".post-container");new h({action:"combunity_get_edit_thread_form_meta",action_save:"combunity_post_thread",id:c.id,container:d,labels:!1})}),a(".combunity-delete-thread-link").on("click",function(a){var b=this;console.log("Delete thread"),a.preventDefault();var c={};c.id=jQuery(this).data("id");var d=jQuery(b).closest(".post-body").find(".post-container"),e=confirm("Are you sure you want to delete this thread?");if(1==e){new h({action:"combunity_get_delete_thread",action_save:"combunity_post_thread",id:c.id,container:d,labels:!1,isdelete:!0})}}),a("#commentform").on("submit",function(a){if("0"==combunity.logged_in)return window.location=combunity.entrance_url,void a.preventDefault()}),jQuery(".submitthread").length>0){if(0==combunity.logged_in)return void jQuery(".submitthread").html(jQuery("#loginmodal").html());var d=jQuery(".submitthread");new h({action:"combunity_get_forum_posts_form_meta",action_save:"combunity_forum_posts_post",container:d,labels:!0,animatedtick:!0,align:"center",nocancel:!0,savebtntext:"Post"})}jQuery(".entrance").length>0&&jQuery(".entrance").html(jQuery("#loginmodal").html())})}(jQuery);